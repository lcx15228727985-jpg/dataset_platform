这是一份基于您提供的代码文件（`texture.py`, `geometry.py`, `ultrasound.py`, `train_texture.py`）的完整数学建模文档。该文档详细描述了从信号生成到物理实现，再到仿真成像和反向优化的全过程数学逻辑。

---

# 连续体机器人超声感知系统的数学建模

## 1. 纹理生成模型 (Texture Generation Model)

我们采用“谱域参数化（Spectral Parameterization）”方法来构建纹理，并通过“减材制造（Engraving）”逻辑将其映射为物理高度。

### 1.1 信号的谱域表示

定义纹理信号场  为圆柱表面  上的标量函数。我们利用混合基函数将其分解：

其中：

* ** (系数矩阵):** 可学习参数矩阵，维度为 。
* ** (Z轴基函数):** 采用离散余弦变换 (DCT-II) 基底，以适应非周期性的 Chirp 信号。


* ** (角度基函数):** 采用傅里叶级数 (Fourier Series) 基底，保证圆周方向的连续性。



### 1.2 双频 Chirp 初始化 (Dual-Tone Chirp Initialization)

为了解决欠定性问题，我们在初始化阶段注入了特定的频率结构。
定义线性调频相位 ：


代码中构建了两个信号分量：

1. **快变信号 (Fast Chirp):** ，频率范围 。
2. **慢变信号 (Slow Chirp):** ，频率范围 。

初始化系数矩阵  使得原始信号近似为：



这在空间中形成了一种受  轴频率调制的螺旋/条纹结构。

### 1.3 物理映射：刻槽逻辑 (Engraving Logic)

为了符合“减材制造”和超声“界面反射”特性，我们采用反转映射。

1. **归一化 (Normalization):** 使用  函数模拟饱和特性，将信号压缩至  区间。


2. **反转高度映射 (Inverted Mapping):**


* **信号强处 ():**  mm  **沟槽 (Groove)**。
* **信号弱处 ():**  mm  **表面 (Surface)**。



---

## 2. 几何运动学模型 (Geometric Kinematics Model)

该模型描述了纹理如何随机器人的弯曲变形。

### 2.1 常曲率运动学 (PCC)

假设机器人的一段具有常曲率  和弯曲平面角 。对于中心轴线上位置 ，表面角度  处的微元，其轴向拉伸应变  为：

### 2.2 坐标变换

观测坐标系下的物理位置  与纹理坐标系下的位置  的映射关系为：

在代码中，通过 `grid_sample` 利用此映射关系从纹理图  中采样得到变形后的表面高度分布 。

---

## 3. 超声成像模型 (Ultrasound Imaging Model)

该模型模拟了 B-Mode 超声探头的脉冲回波（Pulse-Echo）成像过程。

### 3.1 界面深度计算

超声成像测量的本质是飞行时间（Time-of-Flight），对应界面深度。
设探头位于基底上方  处（代码中 `probe_offset = 4.0` mm）。对于探头下方位置  的声束，其接触到的界面深度  为：

* **表面 ():**  mm (浅，图像上方)。
* **沟槽 ():**  mm (深，图像下方)。

### 3.2 B-Scan 图像生成

图像  定义在网格上，其中  为深度方向像素索引。
成像函数模拟了点扩散函数 (PSF) 和高斯强度衰减：

其中 。代码中简化为在界面上下  像素范围内填充高斯强度值。

最后加入乘性散斑噪声：


---

## 4. 反向优化模型 (Inverse Optimization Model)

我们通过梯度下降优化参数矩阵 ，以获得特征最显著的纹理。

### 4.1 损失函数

总目标函数  由三部分组成：

1. **梯度/斜率损失 (Slope Loss):** 鼓励纹理边缘陡峭，增强超声对比度。



（代码中实现为：鼓励高度轮廓的差分绝对值 `grad` 接近或超过阈值 0.4）。
2. **流形拟合损失 (Manifold Loss):** 确保纹理特征的相似性矩阵与物理距离矩阵同构（Isometry）。


*  (特征余弦相似度)
*  (高斯距离核)


3. **正则化损失 (Regularization):** 约束能量，防止数值溢出。



通过最小化该损失函数，系统自动学习出在不同弯曲状态下都能保持高度辨识度和唯一性的刻槽纹理参数。